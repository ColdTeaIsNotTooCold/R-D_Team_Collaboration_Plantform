---
allowed-tools: Bash, Read, Write, LS
---

# PRD 解析

将 PRD 转换为技术实施史诗。

## 使用方法
```
/pm:prd-parse <feature_name>
```

## 必需规则

**重要：** 执行此命令前，请阅读并遵循：
- `.claude/rules/datetime.md` - 用于获取真实当前日期/时间

## 预检查清单

在继续之前，完成这些验证步骤。
不要用预检查进度打扰用户（"我不会..."）。只需执行它们并继续。

### 验证步骤
1. **验证 <feature_name> 是否作为参数提供：**
   - 如果没有，告诉用户："❌ <feature_name> 未作为参数提供。请运行：/pm:prd-parse <feature_name>"
   - 如果未提供 <feature_name>，停止执行

2. **验证 PRD 是否存在：**
   - 检查 `.claude/prds/$ARGUMENTS.md` 是否存在
   - 如果未找到，告诉用户："❌ 未找到 PRD：$ARGUMENTS。首先使用以下命令创建：/pm:prd-new $ARGUMENTS"
   - 如果 PRD 不存在，停止执行

3. **验证 PRD 前置元数据：**
   - 验证 PRD 是否有有效的前置元数据：name，description，status，created
   - 如果前置元数据无效或缺失，告诉用户："❌ 无效的 PRD 前置元数据。请检查：.claude/prds/$ARGUMENTS.md"
   - 显示缺失或无效的内容

4. **检查现有史诗：**
   - 检查 `.claude/epics/$ARGUMENTS/epic.md` 是否已存在
   - 如果存在，询问用户："⚠️ 史诗 '$ARGUMENTS' 已存在。要覆盖吗？（是/否）"
   - 只有在明确确认'是'时才继续
   - 如果用户说否，建议："使用以下命令查看现有史诗：/pm:epic-show $ARGUMENTS"

5. **验证目录权限：**
   - 确保 `.claude/epics/` 目录存在或可以创建
   - 如果无法创建，告诉用户："❌ 无法创建史诗目录。请检查权限。"

## 指示

您是一位技术负责人，正在将产品需求文档转换为详细的技术实施史诗，用于：**$ARGUMENTS**

### 1. 读取 PRD
- 从 `.claude/prds/$ARGUMENTS.md` 加载 PRD
- 分析所有需求和约束
- 理解用户故事和成功标准
- 从前置元数据中提取 PRD 描述

### 2. 技术分析
- 识别需要的架构决策
- 确定技术栈和方法
- 将功能性需求映射到技术组件
- 识别集成点和依赖项

### 3. 带前置元数据的文件格式
在以下位置创建史诗文件：`.claude/epics/$ARGUMENTS/epic.md`，使用此确切结构：

```markdown
---
name: $ARGUMENTS
status: backlog
created: [当前 ISO 日期/时间]
progress: 0%
prd: .claude/prds/$ARGUMENTS.md
github: [同步到 GitHub 时将更新]
---

# 史诗：$ARGUMENTS

## 概述
实施方法的简要技术摘要

## 架构决策
- 关键技术决策和理由
- 技术选择
- 要使用的设计模式

## 技术方法
### 前端组件
- 需要的 UI 组件
- 状态管理方法
- 用户交互模式

### 后端服务
- 需要的 API 端点
- 数据模型和架构
- 业务逻辑组件

### 基础设施
- 部署考虑
- 扩展需求
- 监控和可观察性

## 实施策略
- 开发阶段
- 风险缓解
- 测试方法

## 任务分解预览
将创建的高级任务类别：
- [ ] 类别 1：描述
- [ ] 类别 2：描述
- [ ] 等等。

## 依赖项
- 外部服务依赖
- 内部团队依赖
- 先决条件工作

## 成功标准（技术）
- 性能基准
- 质量门控
- 验收标准

## 估算工作量
- 整体时间线估算
- 资源需求
- 关键路径项目
```

### 4. 前置元数据指南
- **name**：使用确切的功能名称（与 $ARGUMENTS 相同）
- **status**：新史诗始终以 "backlog" 开始
- **created**：通过运行获取真实当前日期时间：`date -u +"%Y-%m-%dT%H:%M:%SZ"`
- **progress**：新史诗始终以 "0%" 开始
- **prd**：引用源 PRD 文件路径
- **github**：保留占位符文本 - 同步期间将更新

### 5. 输出位置
如果目录结构不存在，则创建：
- `.claude/epics/$ARGUMENTS/`（目录）
- `.claude/epics/$ARGUMENTS/epic.md`（史诗文件）

### 6. 质量验证

在保存史诗之前，验证：
- [ ] 所有 PRD 需求都在技术方法中得到解决
- [ ] 任务分解类别涵盖所有实施领域
- [ ] 依赖项在技术上是准确的
- [ ] 工作量估算是现实的
- [ ] 架构决策是合理的

### 7. 创建后

成功创建史诗后：
1. 确认："✅ 史诗已创建：.claude/epics/$ARGUMENTS/epic.md"
2. 显示以下摘要：
   - 识别的任务类别数量
   - 关键架构决策
   - 估算工作量
3. 建议下一步："准备好分解为任务了吗？运行：/pm:epic-decompose $ARGUMENTS"

## 错误恢复

如果任何步骤失败：
- 清楚解释出了什么问题
- 如果 PRD 不完整，列出特定的缺失部分
- 如果技术方法不明确，识别需要澄清的内容
- 永远不要创建信息不完整的史诗

专注于创建技术上合理的实施计划，解决所有 PRD 需求，同时对 "$ARGUMENTS" 保持实用和可实现性。

## 重要：
- 尽可能减少任务数量，并将总任务数限制在 10 个或更少。
- 创建史诗时，识别简化和改进它的方法。尽可能寻找利用现有功能而不是创建更多代码的方法。
